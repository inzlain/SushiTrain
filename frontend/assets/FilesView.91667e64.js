import{_ as f}from"./_plugin-vue_export-helper.cdc0426e.js";import{f as p,o,c as a,a as e,t as r,d as c,b as u,F as m,e as g,g as w,h as k,T as F,j as v,p as y,i as x,k as $}from"./index.82b8fece.js";const C={props:["name","id"],data(){return{showModal:!1}},methods:{deleteFile(){fetch("/api/files/"+this.id,{method:"DELETE"}).then(l=>l.json()).then(l=>{l.deleted===!0?this.$emit("afterDelete"):this.error=l.error})}}},D={key:0,class:"modal is-active"},M={class:"modal-card"},E={class:"modal-card-head"},U=e("p",{class:"modal-card-title"},"Delete File",-1),O={class:"modal-card-body has-text-left"},A={class:"has-text-black"},T=e("br",null,null,-1),L=e("p",{class:"has-text-black"},"This might affect payloads or redirector paths that use this file.",-1),S={class:"modal-card-foot"},V={class:"field is-grouped"},j={class:"control"},B={class:"control"},N=e("a",null,[e("i",{class:"fas fa-trash"})],-1),z=[N];function I(l,s,_,b,t,n){const h=p("tooltip");return o(),a(m,null,[t.showModal?(o(),a("div",D,[e("div",{class:"modal-background",onClick:s[0]||(s[0]=d=>t.showModal=!1)}),e("div",M,[e("header",E,[U,e("button",{class:"delete","aria-label":"close",onClick:s[1]||(s[1]=d=>t.showModal=!1)})]),e("section",O,[e("p",A,"Are you sure you want to delete "+r(_.name)+"?",1),T,L]),e("footer",S,[e("div",V,[e("div",j,[e("button",{type:"button",class:"button is-link is-danger",onClick:s[2]||(s[2]=d=>{t.showModal=!1,n.deleteFile()})},"Delete")]),e("div",B,[e("button",{type:"button",class:"button is-link is-success",onClick:s[3]||(s[3]=d=>t.showModal=!1)},"Cancel")])])])])])):c("",!0),e("div",null,[u((o(),a("span",{class:"icon",onClick:s[4]||(s[4]=d=>t.showModal=!0)},z)),[[h,"Delete file",void 0,{top:!0}]])])],64)}const H=f(C,[["render",I]]),P={components:{FileDelete:H},data(){return{files:[],isLoading:!0,isUploading:!1,showFileOverwriteModal:!1,error:""}},methods:{getFiles(){fetch("/api/files").then(l=>l.json()).then(l=>{this.files=l,this.isLoading=!1})},checkFileExistsAndUpload(){let l=!1;this.files.forEach(s=>{s.name===this.$refs.file.files[0].name&&(l=!0)}),l?this.showFileOverwriteModal=!0:this.uploadFile()},uploadFile(){this.isUploading=!0;let l=new FormData;l.append("file",this.$refs.file.files[0]),fetch("/api/files",{method:"POST",body:l}).then(s=>s.json()).then(s=>{s.uploaded===!0?(this.getFiles(),this.isUploading=!1,this.$refs.file.value=null):(this.error=s.error,this.isUploading=!1,this.$refs.file.value=null)})}},created(){this.getFiles(),this.timer=setInterval(this.getFiles,3e4)},unmounted(){clearInterval(this.timer)}},q={key:0},G={key:0,class:"message is-danger"},J=e("div",{class:"message-header"},[e("p",null,"Error")],-1),K={class:"message-body"},Q={class:"field is-grouped"},R={class:"file is-primary"},W={class:"file-label"},X=e("span",{class:"file-cta"},[e("span",{class:"file-icon"},[e("i",{class:"fas fa-upload"})]),e("span",{class:"file-label"}," Upload File ")],-1),Y=e("br",null,null,-1),Z={class:"message is-primary"},ee={class:"message-header"},se=e("div",null,[e("p",{class:"is-size-4"},[e("i",{class:"fas fa-file","aria-hidden":"true"}),v("\xA0 Files ")])],-1),te={class:"progress is-small is-info",max:"100"},le={class:"message-body"},ie={class:"table is-fullwidth is-hoverable has-background-primary-light"},oe=e("thead",null,[e("tr",null,[e("th",{style:{width:"35%"}},"Filename"),e("th",{style:{width:"10%"}},"Size"),e("th",{style:{width:"50%"}},"SHA-256"),e("th",{style:{width:"5%"}})])],-1),ae={class:"is-truncated"},ne=["href"],de={class:"is-truncated"},re={class:"has-text-centered"},ce={key:1,class:"modal is-active"},he={class:"modal-card"},ue={class:"modal-card-head"},_e=e("p",{class:"modal-card-title"},"Overwrite File",-1),fe={class:"modal-card-body"},pe={class:"has-text-black"},me=e("br",null,null,-1),ve=e("p",{class:"has-text-black"},"This will overwrite the existing file of the same name.",-1),be={class:"modal-card-foot"},ge={class:"field is-grouped"},we={class:"control"},ke={class:"control"};function Fe(l,s,_,b,t,n){const h=g("FileDelete"),d=p("tooltip");return o(),w(F,null,{default:k(()=>[t.isLoading===!1?(o(),a("div",q,[t.error?(o(),a("article",G,[J,e("div",K,r(t.error),1)])):c("",!0),e("div",Q,[e("div",R,[e("label",W,[e("input",{class:"file-input",type:"file",ref:"file",onChange:s[0]||(s[0]=(...i)=>n.checkFileExistsAndUpload&&n.checkFileExistsAndUpload(...i))},null,544),X])])]),Y,e("article",Z,[e("div",ee,[se,v(" \xA0\xA0\xA0 "),u(e("progress",te,"15%",512),[[y,t.isUploading===!0]])]),e("div",le,[e("table",ie,[oe,e("tbody",null,[(o(!0),a(m,null,x(t.files,i=>(o(),a("tr",{key:i.id},[u((o(),a("td",ae,[e("a",{href:"/api/files/"+i.id},r(i.name),9,ne)])),[[d,i.name,void 0,{top:!0}]]),e("td",null,r(i.size.toLocaleString()),1),e("td",de,r(i.hash),1),e("td",re,[$(h,{name:i.name,id:i.id,onAfterDelete:n.getFiles},null,8,["name","id","onAfterDelete"])])]))),128))])])])]),t.showFileOverwriteModal?(o(),a("div",ce,[e("div",{class:"modal-background",onClick:s[1]||(s[1]=i=>t.showFileOverwriteModal=!1)}),e("div",he,[e("header",ue,[_e,e("button",{class:"delete","aria-label":"close",onClick:s[2]||(s[2]=i=>t.showFileOverwriteModal=!1)})]),e("section",fe,[e("p",pe,"Are you sure you want to upload "+r(this.$refs.file.files[0].name)+"?",1),me,ve]),e("footer",be,[e("div",ge,[e("div",we,[e("button",{type:"button",class:"button is-link is-danger",onClick:s[3]||(s[3]=i=>{t.showFileOverwriteModal=!1,n.uploadFile()})},"Upload")]),e("div",ke,[e("button",{type:"button",class:"button is-link is-success",onClick:s[4]||(s[4]=i=>{t.showFileOverwriteModal=!1,this.$refs.file.value=null})},"Cancel")])])])])])):c("",!0)])):c("",!0)]),_:1})}const $e=f(P,[["render",Fe]]);export{$e as default};
